<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="TUnit" basedir="." default="tunit">

	<!-- Reports, archives, statistics, etc. locations -->
	<property environment="env" />
	<property name="tunit_base.dir" value="${env.TUNIT_BASE}" />
	<property name="user.dir" value="/home/mmaroti/tinyos-2.x/tests" />
	<property name="report.dir" value="${tunit_base.dir}/reports" />
	<property name="xml.dir" value="${report.dir}/xml" />
	<property name="htmlreport.dir" value="${report.dir}/html" />
	<property name="archive.dir" value="${report.dir}/archive" />
	<property name="stats.dir" value="${report.dir}/stats" />
	
	<!-- Java locations -->
	<property name="java.dir" value="${tunit_base.dir}/support/sdk/tunit" />
      <property name="tinyos.dir" value="/home/mmaroti/tinyos-2.x" />

	<!-- Jar definitions -->
	<property name="tinyos.jar" value="${tinyos.dir}/support/sdk/java/tinyos.jar" />
	<property name="tunit.jar" value="${java.dir}/tunit.jar" />
	<property name="jcommon.jar" value="${java.dir}/depends/jcommon-1.0.9.jar" />
	<property name="jfreechart.jar" value="${java.dir}/depends/jfreechart-1.0.5.jar" />
	<property name="log4j.jar" value="${java.dir}/depends/log4j.jar" />
	<property name="xerces.jar" value="${java.dir}/depends/xerces.jar" />
	
	<!-- Classpath Definition -->
	<property name="classpath" value="${tinyos.jar}:${tunit.jar}:${jcommon.jar}:${jfreechart.jar}:${log4j.jar}:${xerces.jar}" />

	<target name="tunit">
		<delete dir="${xml.dir}" />
		<mkdir dir="${xml.dir}" />
		<java classname="com.rincon.tunit.TUnit">
			<arg value="-testdir" />
			<arg value="${user.dir}" />
			<classpath>
				<pathelement path="${classpath}" />
			</classpath>
		</java>

		<antcall target="tunitreport" />
		<!-- <antcall target="feedback" /> -->
	</target>


	<target name="tunitrerun">
		<java classname="com.rincon.tunit.TUnit">
			<arg value="-rerun" />
			<classpath>
				<pathelement path="${classpath}" />
			</classpath>
		</java>
		
		<antcall target="tunitreport" />
	</target>


	<target name="tunitreport">
		<delete dir="${htmlreport.dir}" />
		<mkdir dir="${htmlreport.dir}" />
		<mkdir dir="${archive.dir}" />

		<junitreport todir="${xml.dir}">
			<fileset dir="${xml.dir}" includes="TEST-*.xml" />
			<report todir="${htmlreport.dir}" />
		</junitreport>
		
		<java classname="com.rincon.tunitposthtml.PostHtmlEdit">
			<classpath>
				<pathelement path="${classpath}" />
			</classpath>
		</java>

		<tstamp>
			<format property="TIMESTAMP" pattern="d-MMMM-yyyy_hh-mm-aa" />
		</tstamp>

		<property name="archive.prefix" value="htmlreport_${TIMESTAMP}" />

            <tar destfile="${archive.dir}/${archive.prefix}.tar" longfile="gnu">
              <tarfileset dir="${report.dir}" preserveLeadingSlashes="true">
                <include name="html/**"/>
                <include name="stats/**"/>
              </tarfileset>
            </tar>

		<gzip zipfile="${archive.dir}/${archive.prefix}.tar.gz" src="${archive.dir}/${archive.prefix}.tar" />

		<delete>
			<fileset dir="${archive.dir}" includes="*.tar" />
		</delete>

	</target>

	<target name="feedback">
		<java classname="com.rincon.tunitfeedback.TUnitFeedback">
			<classpath>
				<pathelement path="${classpath}" />
			</classpath>
		</java>
	</target>

	<target name="clean">
		<delete dir="${htmlreport.dir}" />
		<delete dir="${xml.dir}" />
	</target>

	<target name="cleanstats">
		<delete dir="${stats.dir}" />
	</target>

</project>
